# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞ amount

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º:**
```
–ú4 –£–ø–∞–∫–æ–≤–∫–∞    8 –ê–ï–ò √ó 1.40 ‚ÇΩ = 11.83 ‚ÇΩ  ‚ùå (–æ–∂–∏–¥–∞–ª–æ—Å—å 11.20 ‚ÇΩ)
–ú4 –£–ø–∞–∫–æ–≤–∫–∞    6 –ê–ï–ò √ó 1.40 ‚ÇΩ = 8.60 ‚ÇΩ   ‚ùå (–æ–∂–∏–¥–∞–ª–æ—Å—å 8.40 ‚ÇΩ)
–ú4 –£–ø–∞–∫–æ–≤–∫–∞   10 –ê–ï–ò √ó 1.40 ‚ÇΩ = 13.55 ‚ÇΩ  ‚ùå (–æ–∂–∏–¥–∞–ª–æ—Å—å 14.00 ‚ÇΩ)
```

**–ü—Ä–∏—á–∏–Ω–∞:**
1. Backend –≤—ã—á–∏—Å–ª—è–ª –ê–ï–ò –∫–∞–∫ **–¥—Ä–æ–±–Ω–æ–µ —á–∏—Å–ª–æ**: `7.98 –ê–ï–ò`
2. –ó–∞—Ç–µ–º —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª `amount = 7.98 √ó 1.40 = 11.17 ‚ÇΩ`
3. –ù–æ —Å–æ—Ö—Ä–∞–Ω—è–ª –≤ –ë–î `count = 8` (–æ–∫—Ä—É–≥–ª–µ–Ω–Ω–æ–µ)
4. Frontend –ø–æ–∫–∞–∑—ã–≤–∞–ª `8 √ó 1.40 = 11.20 ‚ÇΩ`
5. –ù–æ –∏–∑ –ë–î –ø—Ä–∏—Ö–æ–¥–∏–ª–æ `amount = 11.17 ‚ÇΩ` ‚Üí **–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ!**

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º **–æ–∫—Ä—É–≥–ª–µ–Ω–Ω–æ–µ –ê–ï–ò** –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º—ã:
```
–ê–ï–ò_–¥—Ä–æ–±–Ω–æ–µ = (Actdura / 60) √ó –ù–æ—Ä–º–∞—Ç–∏–≤
–ê–ï–ò_–æ–∫—Ä—É–≥–ª–µ–Ω–Ω–æ–µ = Math.round(–ê–ï–ò_–¥—Ä–æ–±–Ω–æ–µ)
amount = –ê–ï–ò_–æ–∫—Ä—É–≥–ª–µ–Ω–Ω–æ–µ √ó –†–∞—Å—Ü–µ–Ω–∫–∞
```

**–ü—Ä–∏–º–µ—Ä:**
- Actdura = 5.7 –º–∏–Ω
- –ù–æ—Ä–º–∞—Ç–∏–≤ = 84 –ê–ï–ò/—á–∞—Å
- –†–∞—Å—Ü–µ–Ω–∫–∞ = 1.40 ‚ÇΩ

**–†–∞—Å—á–µ—Ç:**
- –ê–ï–ò_–¥—Ä–æ–±–Ω–æ–µ = (5.7 / 60) √ó 84 = 7.98
- –ê–ï–ò_–æ–∫—Ä—É–≥–ª–µ–Ω–Ω–æ–µ = 8
- amount = 8 √ó 1.40 = **11.20 ‚ÇΩ** ‚úÖ

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### 1. –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (Windows)

```powershell
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É backend
cd D:\work\komus\selary\backend

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ—Å—á–µ—Ç–∞
node scripts/fix-amounts-formula.js
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
- –û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ `amount` –≤ —Ç–∞–±–ª–∏—Ü–µ `operations`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º—É–ª—É: `amount = count √ó rate`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

### 2. –ù–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (Linux)

```bash
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /home/admin-lc/salary_monitor

# 2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull

# 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å backend
cd backend
npm run build

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend
pm2 restart salary-monitor-backend

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–µ—Å—á–µ—Ç
node scripts/fix-amounts-formula.js

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs salary-monitor-backend --lines 50
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
node scripts/check-calculation.js
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –£–ø–∞–∫–æ–≤–∫–∞:

ID: 12345
  –î–∞—Ç–∞: 29.01.2026 03:00
  –¢–∏–ø: –ú4 –£–ø–∞–∫–æ–≤–∫–∞
  –ê–ï–ò (–≤ –ë–î): 8
  –°—É–º–º–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å): 11.20 ‚ÇΩ
  –°—É–º–º–∞ (–≤ –ë–î):        11.20 ‚ÇΩ
  ‚úÖ –†–∞—Å—á–µ—Ç –≤–µ—Ä–Ω—ã–π
```

---

## üìê –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞

### **–ü–æ–ª–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã:**

1. **–ê–ï–ò (–¥—Ä–æ–±–Ω–æ–µ):**
   ```
   –ê–ï–ò_–¥—Ä–æ–±–Ω–æ–µ = (Actdura_–º–∏–Ω—É—Ç—ã / 60) √ó –ù–æ—Ä–º–∞—Ç–∏–≤_–ê–ï–ò_–≤_—á–∞—Å
   ```

2. **–ê–ï–ò (–æ–∫—Ä—É–≥–ª–µ–Ω–Ω–æ–µ –¥–ª—è –ë–î):**
   ```
   –ê–ï–ò = Math.round(–ê–ï–ò_–¥—Ä–æ–±–Ω–æ–µ)
   ```

3. **–ë–∞–∑–æ–≤–∞—è —Å—É–º–º–∞ –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏—é:**
   ```
   –ë–∞–∑–æ–≤–∞—è_—Å—É–º–º–∞ = –ê–ï–ò √ó –†–∞—Å—Ü–µ–Ω–∫–∞
   ```

4. **–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥:**
   ```
   –ò—Ç–æ–≥–æ–≤–∞—è_—Å—É–º–º–∞ = Œ£(–ë–∞–∑–æ–≤–∞—è_—Å—É–º–º–∞) √ó –ö–∫–∞—á
   ```

---

## üìù –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### `backend/src/sap-integration/sap-integration.service.ts`

**–ë—ã–ª–æ:**
```typescript
const calculatedAEI = (operation.actdura / 60) * (tariff.norm_aei_per_hour || 0);
const amount = calculatedAEI * rate * 1.0;
// ...
count: Math.round(calculatedAEI)  // –û–∫—Ä—É–≥–ª—è–µ–º —Ç–æ–ª—å–∫–æ count
```

**–°—Ç–∞–ª–æ:**
```typescript
const calculatedAEI = (operation.actdura / 60) * (tariff.norm_aei_per_hour || 0);
const roundedAEI = Math.round(calculatedAEI);  // –û–∫—Ä—É–≥–ª—è–µ–º –ê–ï–ò
const amount = roundedAEI * rate;  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–∫—Ä—É–≥–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
// ...
count: roundedAEI
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å:
- `count` –≤ –ë–î = –æ–∫—Ä—É–≥–ª–µ–Ω–Ω–æ–µ –ê–ï–ò
- `amount` –≤ –ë–î = `count √ó rate`
- Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: `count √ó rate`
- –í—Å—ë **—Å–æ–≤–ø–∞–¥–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ!** ‚úÖ

**–ü—Ä–∏–º–µ—Ä:**
```
–ú4 –£–ø–∞–∫–æ–≤–∫–∞    8 –ê–ï–ò √ó 1.40 ‚ÇΩ = 11.20 ‚ÇΩ  ‚úÖ
–ú4 –£–ø–∞–∫–æ–≤–∫–∞    6 –ê–ï–ò √ó 1.40 ‚ÇΩ = 8.40 ‚ÇΩ   ‚úÖ
–ú4 –£–ø–∞–∫–æ–≤–∫–∞   10 –ê–ï–ò √ó 1.40 ‚ÇΩ = 14.00 ‚ÇΩ  ‚úÖ
```

---

## üìû –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (`.env` —Ñ–∞–π–ª)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `tariffs` –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs salary-monitor-backend`
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É: `node scripts/check-calculation.js`
